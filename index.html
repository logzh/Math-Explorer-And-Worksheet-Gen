<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Math Explorer for Kids</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @media print {
        @page { size: A4 portrait; margin: 1cm; }
        body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background-color: white; }
        .no-print { display: none !important; }
        #section-learn { display: none !important; }
        #section-print { display: block !important; }
        #worksheet-grid { gap: 1.5rem; }
        /* Force black text for better printing */
        * { color: black !important; border-color: #e2e8f0 !important; }
        #worksheet-grid div span.text-indigo-600 { color: #000 !important; font-weight: bold; }
      }
      .fade-in { animation: fadeIn 0.3s ease-in; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
      
      /* Custom scrollbar for fun feel */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #f1f5f9; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0"
        }
      }
    </script>
  </head>
  <body class="bg-slate-50 text-slate-900 font-sans min-h-screen flex flex-col">
    
    <!-- Navigation / Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 no-print shadow-sm">
        <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
          <div class="flex items-center gap-3">
             <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white text-xl shadow-lg transform hover:rotate-12 transition-transform duration-300">
               üßÆ
             </div>
             <h1 class="text-xl font-black text-slate-800 tracking-tight hidden md:block">
               Kids Math <span class="text-indigo-600">Explorer</span>
             </h1>
          </div>

          <nav class="flex bg-slate-100 p-1 rounded-xl">
            <button id="nav-learn" class="px-4 py-2 rounded-lg text-sm font-bold transition-all bg-white text-indigo-700 shadow-sm">
              Learn & Visuals
            </button>
            <button id="nav-print" class="px-4 py-2 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-slate-700 hover:bg-slate-200/50">
              Print Worksheets
            </button>
          </nav>
        </div>
    </header>

    <main class="flex-grow pt-6 pb-12 px-4">
        
        <!-- SECTION: VISUALIZER -->
        <div id="section-learn" class="max-w-4xl mx-auto space-y-8 fade-in">
            <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-200">
                <div class="p-6 bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
                  <h2 class="text-2xl font-bold flex items-center gap-2">
                    <span class="text-3xl">üéì</span> Learn Together
                  </h2>
                  <p class="text-indigo-100 opacity-90 font-medium">Adjust the numbers to see how math works!</p>
                </div>
        
                <div class="p-6 md:p-8 space-y-8">
                  <!-- Controls -->
                  <div class="flex flex-wrap gap-6 justify-center bg-slate-50 p-6 rounded-2xl border border-slate-100 dashed">
                     <div class="flex flex-col gap-2">
                        <label class="font-bold text-slate-600 text-xs uppercase tracking-wider">Operation</label>
                        <div class="flex bg-white rounded-xl p-1 border border-slate-200 shadow-sm">
                          <button id="btn-op-mul" class="px-5 py-2 rounded-lg text-sm font-bold transition-all bg-indigo-500 text-white shadow-md transform hover:scale-105">
                            Multiply (√ó)
                          </button>
                          <button id="btn-op-div" class="px-5 py-2 rounded-lg text-sm font-bold transition-all text-slate-500 hover:bg-slate-50 hover:text-indigo-600">
                            Divide (√∑)
                          </button>
                        </div>
                     </div>
        
                     <div class="flex flex-col gap-2 w-36">
                        <label id="lbl-num1" class="font-bold text-slate-600 text-xs uppercase tracking-wider">Groups</label>
                        <input type="number" id="inp-num1" min="1" max="12" value="3" class="border-2 border-slate-200 rounded-xl px-3 py-2 text-center text-2xl font-black focus:border-indigo-500 outline-none text-indigo-700 shadow-inner bg-white" />
                     </div>
        
                     <div class="flex flex-col gap-2 w-36">
                        <label id="lbl-num2" class="font-bold text-slate-600 text-xs uppercase tracking-wider">Items/Group</label>
                        <input type="number" id="inp-num2" min="1" max="12" value="4" class="border-2 border-slate-200 rounded-xl px-3 py-2 text-center text-2xl font-black focus:border-indigo-500 outline-none text-indigo-700 shadow-inner bg-white" />
                     </div>
                  </div>
        
                  <!-- Equation Display -->
                  <div class="text-center space-y-2 py-4">
                    <div class="text-5xl md:text-7xl font-black text-slate-800 tracking-tight flex flex-wrap items-center justify-center gap-4">
                      <span id="eq-a" class="bg-slate-100 px-4 py-2 rounded-xl border border-slate-200">3</span>
                      <span id="eq-sym" class="text-indigo-500">√ó</span>
                      <span id="eq-b" class="bg-slate-100 px-4 py-2 rounded-xl border border-slate-200">4</span>
                      <span class="text-slate-400">=</span>
                      <span id="eq-res" class="text-green-600 bg-green-50 px-4 py-2 rounded-xl border border-green-200 shadow-sm">12</span>
                    </div>
                    <p id="eq-label" class="text-xl text-slate-500 font-bold mt-4">3 groups of 4</p>
                  </div>
        
                  <!-- Visual Grid -->
                  <div id="visual-grid" class="flex flex-wrap gap-4 justify-center items-center min-h-[240px] bg-slate-50 rounded-2xl p-8 border-2 border-dashed border-slate-300 relative">
                    <!-- JS Injected content -->
                    <div class="absolute inset-0 flex items-center justify-center text-slate-300 font-bold pointer-events-none opacity-0">
                        Visual Area
                    </div>
                  </div>
        
                  <!-- AI Tutor Section -->
                  <div class="border-t border-slate-100 pt-6">
                    <div id="ai-prompt-container">
                        <button id="btn-ask-ai" class="w-full py-4 rounded-2xl bg-gradient-to-r from-pink-500 to-rose-500 text-white font-bold text-lg shadow-lg hover:shadow-xl hover:scale-[1.01] active:scale-[0.99] transition-all flex items-center justify-center gap-3 group">
                            <span class="text-2xl group-hover:animate-bounce">ü§ñ</span> 
                            <span>Ask AI Tutor to Explain This!</span>
                        </button>
                    </div>
        
                    <div id="ai-loading" class="hidden w-full py-8 flex flex-col items-center justify-center text-slate-400 gap-3">
                        <div class="flex gap-2">
                            <div class="w-3 h-3 bg-rose-400 rounded-full animate-bounce" style="animation-delay: 0s"></div>
                            <div class="w-3 h-3 bg-rose-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-3 h-3 bg-rose-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                        <p class="font-medium text-rose-400">Thinking of a fun story...</p>
                    </div>
        
                    <div id="ai-response" class="hidden mt-6 bg-white rounded-2xl p-6 border-2 border-rose-100 shadow-sm relative fade-in mx-2 md:mx-4">
                         <div class="absolute -top-5 -left-2 bg-rose-100 text-3xl p-2 rounded-xl border-4 border-white shadow-sm transform -rotate-6">ü§ñ</div>
                         <div class="pl-4">
                             <h3 class="text-rose-600 font-black uppercase tracking-wide text-sm mb-3">AI Tutor Says:</h3>
                             <p id="ai-text" class="text-slate-700 leading-relaxed text-lg font-medium"></p>
                             <button id="btn-retry-ai" class="mt-4 text-rose-500 text-sm font-bold flex items-center gap-1 hover:text-rose-700 transition-colors">
                                 <span>üîÑ</span> Try another explanation
                             </button>
                         </div>
                    </div>
                  </div>
                </div>
            </div>
        </div>

        <!-- SECTION: WORKSHEET -->
        <div id="section-print" class="max-w-5xl mx-auto space-y-6 hidden fade-in">
            <div class="no-print bg-white rounded-2xl shadow-lg p-6 border border-slate-200">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                   <div>
                       <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                         <span>üñ®Ô∏è</span> Worksheet Setup
                       </h2>
                       <p class="text-slate-500 text-sm mt-1">Customize and print math problems for practice.</p>
                   </div>
                   <div class="flex gap-3 w-full md:w-auto">
                      <button id="btn-refresh" class="flex-1 md:flex-none bg-slate-100 text-slate-700 px-4 py-3 rounded-xl font-bold hover:bg-slate-200 transition-colors flex items-center justify-center gap-2">
                        <span>üîÑ</span> New Questions
                      </button>
                      <button id="btn-print" class="flex-1 md:flex-none bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2">
                        <span>üñ®Ô∏è</span> Print PDF
                      </button>
                   </div>
                </div>
        
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
                  <div class="flex flex-col gap-2">
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Question Type</label>
                    <select id="cfg-op" class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 font-semibold focus:ring-2 focus:ring-indigo-500 outline-none">
                      <option value="multiply">Multiplication Only</option>
                      <option value="divide">Division Only</option>
                      <option value="mixed">Mixed (√ó and √∑)</option>
                    </select>
                  </div>
        
                  <div class="flex flex-col gap-2">
                     <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Difficulty (Max Num)</label>
                     <select id="cfg-max" class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 font-semibold focus:ring-2 focus:ring-indigo-500 outline-none">
                      <option value="5">Very Easy (1-5)</option>
                      <option value="9" selected>Standard (1-9)</option>
                      <option value="12">Advanced (1-12)</option>
                      <option value="20">Challenger (1-20)</option>
                    </select>
                  </div>
        
                  <div class="flex flex-col gap-2">
                     <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Count</label>
                     <select id="cfg-count" class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 font-semibold focus:ring-2 focus:ring-indigo-500 outline-none">
                      <option value="10">10 Questions</option>
                      <option value="20">20 Questions</option>
                      <option value="30">30 Questions</option>
                      <option value="40" selected>40 Questions</option>
                      <option value="50">50 Questions</option>
                    </select>
                  </div>
                  
                  <div class="flex flex-col gap-2 items-start pt-1 md:justify-end h-full">
                    <label class="flex items-center gap-3 cursor-pointer select-none bg-slate-50 border border-slate-200 px-4 py-3 rounded-xl w-full hover:bg-slate-100 transition-colors h-[50px]">
                        <input type="checkbox" id="cfg-answers" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300" />
                        <span class="text-sm font-bold text-slate-700">Show Answers</span>
                    </label>
                  </div>
                </div>
            </div>

            <!-- Worksheet Output -->
            <div class="bg-white p-8 md:p-12 shadow-2xl md:mx-auto print:shadow-none print:p-0 print:mx-0 max-w-[21cm] min-h-[29.7cm] print:w-full print:max-w-none">
                <div class="text-center mb-8 pb-4 border-b-2 border-slate-100 flex flex-col gap-2">
                    <h1 class="text-3xl font-black text-slate-800 uppercase tracking-widest">Math Worksheet</h1>
                    <p class="text-slate-400 text-sm font-medium italic">Keep practicing to become a math wizard!</p>
                    <div class="flex justify-between text-slate-500 font-bold text-sm mt-6 bg-slate-50 p-4 rounded-lg border border-slate-100 print:bg-transparent print:border-none print:p-0">
                        <span>Name: <span class="inline-block w-48 border-b-2 border-slate-300 print:border-slate-800"></span></span>
                        <span>Date: <span class="inline-block w-32 border-b-2 border-slate-300 print:border-slate-800"></span></span>
                        <span>Score: <span class="inline-block w-16 border-b-2 border-slate-300 print:border-slate-800"></span> / <span id="score-total">40</span></span>
                    </div>
                </div>
                
                <div id="worksheet-grid" class="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-10 print:grid-cols-4 print:gap-y-8 print:text-base">
                    <!-- Questions injected here -->
                </div>

                <div class="mt-12 text-center text-slate-300 text-xs print:block hidden">
                    Generated by Kids Math Explorer
                </div>
            </div>
        </div>

    </main>

    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        // --- STATE ---
        const state = {
            visual: {
                num1: 3,
                num2: 4,
                op: 'multiply' // 'multiply' | 'divide'
            },
            worksheet: {
                count: 40,
                max: 9,
                op: 'multiply', // 'multiply' | 'divide' | 'mixed'
                showAnswers: false
            }
        };

        // --- DOM ELEMENTS ---
        const els = {
            nav: {
                learn: document.getElementById('nav-learn'),
                print: document.getElementById('nav-print'),
            },
            sections: {
                learn: document.getElementById('section-learn'),
                print: document.getElementById('section-print'),
            },
            vis: {
                btnMul: document.getElementById('btn-op-mul'),
                btnDiv: document.getElementById('btn-op-div'),
                inp1: document.getElementById('inp-num1'),
                inp2: document.getElementById('inp-num2'),
                lbl1: document.getElementById('lbl-num1'),
                lbl2: document.getElementById('lbl-num2'),
                eqA: document.getElementById('eq-a'),
                eqB: document.getElementById('eq-b'),
                eqSym: document.getElementById('eq-sym'),
                eqRes: document.getElementById('eq-res'),
                eqLabel: document.getElementById('eq-label'),
                grid: document.getElementById('visual-grid'),
                askBtn: document.getElementById('btn-ask-ai'),
                retryBtn: document.getElementById('btn-retry-ai'),
                promptContainer: document.getElementById('ai-prompt-container'),
                loader: document.getElementById('ai-loading'),
                response: document.getElementById('ai-response'),
                aiText: document.getElementById('ai-text')
            },
            ws: {
                op: document.getElementById('cfg-op'),
                max: document.getElementById('cfg-max'),
                count: document.getElementById('cfg-count'),
                answers: document.getElementById('cfg-answers'),
                refresh: document.getElementById('btn-refresh'),
                print: document.getElementById('btn-print'),
                grid: document.getElementById('worksheet-grid'),
                scoreTotal: document.getElementById('score-total')
            }
        };

        // --- INIT ---
        function init() {
            // Nav Listeners
            els.nav.learn.addEventListener('click', () => switchTab('learn'));
            els.nav.print.addEventListener('click', () => switchTab('print'));

            // Visualizer Listeners
            els.vis.btnMul.addEventListener('click', () => setVisualOp('multiply'));
            els.vis.btnDiv.addEventListener('click', () => setVisualOp('divide'));
            els.vis.inp1.addEventListener('change', updateVisualState);
            els.vis.inp2.addEventListener('change', updateVisualState);
            els.vis.inp1.addEventListener('input', updateVisualState);
            els.vis.inp2.addEventListener('input', updateVisualState);
            els.vis.askBtn.addEventListener('click', askAI);
            els.vis.retryBtn.addEventListener('click', askAI);

            // Worksheet Listeners
            els.ws.op.addEventListener('change', updateWorksheetConfig);
            els.ws.max.addEventListener('change', updateWorksheetConfig);
            els.ws.count.addEventListener('change', updateWorksheetConfig);
            els.ws.answers.addEventListener('change', updateWorksheetConfig);
            els.ws.refresh.addEventListener('click', generateWorksheet);
            els.ws.print.addEventListener('click', () => window.print());

            // Initial Render
            renderVisualizer();
            generateWorksheet();
        }

        // --- NAVIGATION ---
        function switchTab(tab) {
            if (tab === 'learn') {
                els.sections.learn.classList.remove('hidden');
                els.sections.print.classList.add('hidden');
                els.nav.learn.classList.add('bg-white', 'text-indigo-700', 'shadow-sm');
                els.nav.learn.classList.remove('text-slate-500');
                els.nav.print.classList.remove('bg-white', 'text-indigo-700', 'shadow-sm');
                els.nav.print.classList.add('text-slate-500');
            } else {
                els.sections.learn.classList.add('hidden');
                els.sections.print.classList.remove('hidden');
                els.nav.print.classList.add('bg-white', 'text-indigo-700', 'shadow-sm');
                els.nav.print.classList.remove('text-slate-500');
                els.nav.learn.classList.remove('bg-white', 'text-indigo-700', 'shadow-sm');
                els.nav.learn.classList.add('text-slate-500');
            }
        }

        // --- VISUALIZER LOGIC ---
        function setVisualOp(op) {
            state.visual.op = op;
            // Reset UI for AI
            els.vis.response.classList.add('hidden');
            els.vis.promptContainer.classList.remove('hidden');
            
            if (op === 'multiply') {
                els.vis.btnMul.classList.add('bg-indigo-500', 'text-white', 'shadow-md');
                els.vis.btnMul.classList.remove('text-slate-500', 'hover:bg-slate-50', 'hover:text-indigo-600');
                els.vis.btnDiv.classList.remove('bg-indigo-500', 'text-white', 'shadow-md');
                els.vis.btnDiv.classList.add('text-slate-500', 'hover:bg-slate-50', 'hover:text-indigo-600');
                els.vis.lbl1.textContent = 'Groups';
                els.vis.lbl2.textContent = 'Items/Group';
            } else {
                els.vis.btnDiv.classList.add('bg-indigo-500', 'text-white', 'shadow-md');
                els.vis.btnDiv.classList.remove('text-slate-500', 'hover:bg-slate-50', 'hover:text-indigo-600');
                els.vis.btnMul.classList.remove('bg-indigo-500', 'text-white', 'shadow-md');
                els.vis.btnMul.classList.add('text-slate-500', 'hover:bg-slate-50', 'hover:text-indigo-600');
                els.vis.lbl1.textContent = 'Friends (Divisor)';
                els.vis.lbl2.textContent = 'Answer (Result)';
            }
            renderVisualizer();
        }

        function updateVisualState() {
            let v1 = parseInt(els.vis.inp1.value) || 1;
            let v2 = parseInt(els.vis.inp2.value) || 1;
            v1 = Math.max(1, Math.min(12, v1));
            v2 = Math.max(1, Math.min(12, v2));
            state.visual.num1 = v1;
            state.visual.num2 = v2;
            
            // Hide AI response on change
            els.vis.response.classList.add('hidden');
            els.vis.promptContainer.classList.remove('hidden');

            renderVisualizer();
        }

        function renderVisualizer() {
            const { num1, num2, op } = state.visual;
            let a, b, res, sym, label;
            let groups, itemsPerGroup;

            if (op === 'multiply') {
                a = num1; 
                b = num2;
                res = num1 * num2;
                sym = '√ó';
                label = `${num1} groups of ${num2}`;
                groups = num1;
                itemsPerGroup = num2;
            } else {
                // Division: Input num1 (groups/divisor), num2 (result).
                // Math: (num1 * num2) / num1 = num2
                // Display: Total / Divisor = Result
                const total = num1 * num2;
                a = total;
                b = num1;
                res = num2;
                sym = '√∑';
                label = `${total} shared by ${num1}`;
                groups = num1; // We visualize the friends (groups)
                itemsPerGroup = num2; // How many each gets
            }

            els.vis.eqA.textContent = a;
            els.vis.eqB.textContent = b;
            els.vis.eqSym.textContent = sym;
            els.vis.eqRes.textContent = res;
            els.vis.eqLabel.textContent = label;

            // Render Grid
            els.vis.grid.innerHTML = '';
            const colors = [
                { bg: 'bg-red-400', border: 'border-red-400', icon: 'text-red-100' },
                { bg: 'bg-blue-400', border: 'border-blue-400', icon: 'text-blue-100' },
                { bg: 'bg-green-400', border: 'border-green-400', icon: 'text-green-100' },
                { bg: 'bg-yellow-400', border: 'border-yellow-400', icon: 'text-yellow-100' },
                { bg: 'bg-purple-400', border: 'border-purple-400', icon: 'text-purple-100' },
                { bg: 'bg-pink-400', border: 'border-pink-400', icon: 'text-pink-100' }
            ];
            const starSvg = `<svg viewBox="0 0 24 24" fill="currentColor" class="w-full h-full drop-shadow-sm"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" /></svg>`;

            for (let i = 0; i < groups; i++) {
                const groupEl = document.createElement('div');
                const theme = colors[i % colors.length];
                groupEl.className = `p-3 rounded-2xl ${theme.bg} bg-opacity-20 border-2 ${theme.border} flex flex-wrap gap-1 items-center justify-center min-w-[80px] min-h-[80px] shadow-sm transition-all hover:scale-105`;
                
                for (let j = 0; j < itemsPerGroup; j++) {
                    const itemEl = document.createElement('div');
                    // Slightly rotate items for a natural look
                    const rotate = (i + j) % 2 === 0 ? 'rotate-3' : '-rotate-3';
                    itemEl.className = `w-8 h-8 md:w-10 md:h-10 ${theme.border.replace('border-', 'text-')} flex items-center justify-center ${rotate}`;
                    itemEl.innerHTML = starSvg;
                    groupEl.appendChild(itemEl);
                }
                els.vis.grid.appendChild(groupEl);
            }
        }

        async function askAI() {
            const apiKey = process.env.API_KEY;
            if (!apiKey) {
                els.vis.aiText.textContent = "API Key missing. Please configure process.env.API_KEY.";
                els.vis.loader.classList.add('hidden');
                els.vis.response.classList.remove('hidden');
                return;
            }

            const ai = new GoogleGenAI({ apiKey: apiKey });
            const { num1, num2, op } = state.visual;
            
            // UI State: Loading
            els.vis.promptContainer.classList.add('hidden');
            els.vis.response.classList.add('hidden');
            els.vis.loader.classList.remove('hidden');

            let a, b, sym;
            if (op === 'multiply') {
                a = num1; b = num2; sym = '√ó';
            } else {
                a = num1 * num2; b = num1; sym = '√∑';
            }

            let prompt = "";
            if (op === 'multiply') {
                prompt = `Explain the multiplication problem ${a} ${sym} ${b} to a 6-year-old child. 
                Use a creative, short story involving animals, fruits, or toys to visualize it. 
                Keep the language very simple, encouraging, and fun. Use emojis. 
                Keep it under 80 words.`;
            } else {
                prompt = `Explain the division problem ${a} ${sym} ${b} to a 6-year-old child. 
                Describe it as sharing items equally among friends or groups. 
                Use a creative, short story. 
                Keep the language very simple, encouraging, and fun. Use emojis. 
                Keep it under 80 words.`;
            }

            try {
                const response = await ai.models.generateContent({
                    model: 'gemini-2.5-flash',
                    contents: prompt,
                });
                const text = response.text || "Oops! I couldn't think of a story right now. Try again!";
                els.vis.aiText.textContent = text;
            } catch (error) {
                console.error(error);
                els.vis.aiText.textContent = "Sorry, my brain is tired. Try again later!";
            } finally {
                els.vis.loader.classList.add('hidden');
                els.vis.response.classList.remove('hidden');
            }
        }

        // --- WORKSHEET LOGIC ---
        function updateWorksheetConfig() {
            state.worksheet.op = els.ws.op.value;
            state.worksheet.max = parseInt(els.ws.max.value);
            state.worksheet.count = parseInt(els.ws.count.value);
            state.worksheet.showAnswers = els.ws.answers.checked;
            generateWorksheet();
        }

        function generateWorksheet() {
            const { op, max, count, showAnswers } = state.worksheet;
            els.ws.grid.innerHTML = '';
            els.ws.scoreTotal.textContent = count;
            
            // Update Grid Layout Class
            els.ws.grid.className = `grid gap-x-8 gap-y-10 print:grid-cols-4 print:gap-y-6 print:text-base ${
                count > 40 ? 'grid-cols-4 text-sm' : 'grid-cols-2 md:grid-cols-4 text-xl'
            }`;

            for (let i = 0; i < count; i++) {
                const isMultiply = 
                    op === 'multiply' ? true : 
                    op === 'divide' ? false : 
                    Math.random() > 0.5;

                let n1, n2, ans, sym;

                if (isMultiply) {
                    n1 = Math.floor(Math.random() * (max - 1)) + 2; 
                    n2 = Math.floor(Math.random() * 9) + 1;
                    ans = n1 * n2;
                    sym = '√ó';
                    if (Math.random() > 0.5) [n1, n2] = [n2, n1];
                } else {
                    ans = Math.floor(Math.random() * 9) + 1;
                    n2 = Math.floor(Math.random() * (max - 1)) + 2;
                    n1 = ans * n2;
                    sym = '√∑';
                }

                const item = document.createElement('div');
                item.className = "flex items-center gap-2 font-mono font-bold text-slate-800 justify-center p-2 border-b border-slate-100 print:border-none";
                
                const problemText = `${n1} ${sym} ${n2} = `;
                const answerText = showAnswers 
                    ? `<span class="text-indigo-600">${ans}</span>` 
                    : `<span class="text-slate-200 print:text-slate-300 select-none">__</span>`;
                
                item.innerHTML = `<span>${problemText}</span> ${answerText}`;
                els.ws.grid.appendChild(item);
            }
        }

        // Start
        init();

    </script>
  </body>
</html>